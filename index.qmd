---
title: "Calidad de aire"
author: "MESOMI"
logo: quarto.png
lang: es
format: 
  dashboard:
    orientation: columns
    theme:
      light: flatly
      dark: superhero
execute: 
  message: false
  warning: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
library(tidyverse)
library(openair)
library(openxlsx)
library(zoo)
library(ggthemes)
library(ggforce)
library(patchwork)
library(ggrepel)
source("Scripts/ECA.R")

# Cargando datos del punto de hipólito unanue:
df <- ECA(meteo = "input/CR1000_JULIO_2024.csv",
          gases = "input/eca_2024_julio.csv",
          pm = "input/pm_junio.csv",
          fecha_inicio = "2024-06-21",
          fecha_fin = "2024-06-30",
          estacion = "Unanue",
          tipo = "lista")
```

# Datos del 2024
## column {.tabset}
### EMCA - 01 {.tabset}
#### PM10
```{r}
#| title: "PM10 diario"

df$eca<- df$eca %>% 
  mutate(fecha = as.Date(fecha, format = "%d-%B"))

med <- df$eca$fecha

g1 <- df$eca %>% 
  ggplot(aes(x = fecha, y = pm10)) +
  geom_hline(yintercept = 100, lty = 2, color = "hotpink") +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(x = median(fecha),
                   y = 105,label = "ECA"),
            color = "red") +
  labs(x = "", y = "PM10")+
  theme_minimal()

plotly::ggplotly(g1)
```

```{r}
#| title: "PM10 horario"

g2 <- df$df %>% 
  ggplot(aes(x = date, y = pm10)) +
  geom_hline(yintercept = 100, lty = 2, color = "hotpink") +
  geom_line(color = "skyblue") +
  geom_text(aes(x = median(df$df$date, na.rm = T),
                   y = 105,label = "ECA", color = "red")) +
  labs(x = "", y = "PM10")+
  theme_minimal() + theme(legend.position = "none")

plotly::ggplotly(g2)
```

#### PM2.5
```{r}
#| title: "PM2.5 diario"

df$eca<- df$eca %>% 
  mutate(fecha = as.Date(fecha, format = "%d-%B"))

med <- df$eca$fecha

g3 <- df$eca %>% 
  ggplot(aes(x = fecha, y = pm25)) +
  geom_hline(yintercept = 50, lty = 2, color = "hotpink") +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(x = median(fecha),
                   y = 55,label = "ECA"),
            color = "red" ) +
  labs(x = "", y = "PM2.5")+
  theme_minimal()

plotly::ggplotly(g3)
```

```{r}
#| title: "PM2.5 horario"

g4 <- df$df %>% 
  ggplot(aes(x = date, y = pm25)) +
  geom_hline(yintercept = 50, lty = 2, color = "hotpink") +
  geom_line(color = "skyblue") +
  geom_text(aes(x = median(df$df$date, na.rm = T),
                   y = 55,label = "ECA",
                color = "red")) +
  labs(x = "", y = "PM2.5")+
  theme_minimal() + theme(legend.position = "none")

plotly::ggplotly(g4)
```

#### Tabla de datos

```{r}
#| title: "Datos diarios (ug/m3)"
library(DT)

n <- df$eca %>% 
  rename_at(
      vars(names(.)),
      ~ c("Fecha", "PM2.5", "PM10", 
          "NO2", "SO2", "H2S",
          "CO(1h)", "CO(8h)", "O3(8h)"))

datatable(
  n, extensions = 'Buttons',
  caption = 'Tabla 1: Datos horarios - Hipólito Unanue',
  options = list(
    autowidth = TRUE,
    pageLength = 20,
    dom = 'Bfrtip',
    buttons = list('copy', 'print', list(
        extend = 'collection',
        buttons = c('csv', 'excel', 'pdf'),
        text = 'Download')))
  ) %>% formatRound(
    columns = colnames(n %>% select(-Fecha)), digits = 2)
```

### EMCA - 02 {.tabset}
#### PM10

```{r}
#| title: "PM10 diario"

# Cargando datos del punto de instituto vigil:
df1 <- ECA(meteo = "input/CR1000_JULIO_2024.csv",
          gases = "input/eca_2024_julio.csv",
          pm = "input/1405A227561402_2024-08-01_09-11-26.csv",
          fecha_inicio = "2024-07-17",
          fecha_fin = "2024-07-31",
          estacion = "Vigil",
          tipo = "lista")

df1$eca<- df1$eca %>% 
  mutate(fecha = as.Date(fecha, format = "%d-%B"))

med <- df1$eca$fecha

g5 <- df1$eca %>% 
  ggplot(aes(x = fecha, y = pm10)) +
  geom_hline(yintercept = 100, lty = 2, color = "hotpink") +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(x = median(fecha),
                   y = 105,label = "ECA"),
            color = "red") +
  labs(x = "", y = "PM10")+
  theme_minimal()

plotly::ggplotly(g5)
```

```{r}
#| title: "PM10 horario"

g6 <- df1$df %>% 
  ggplot(aes(x = date, y = pm10)) +
  geom_hline(yintercept = 100, lty = 2, color = "hotpink") +
  geom_line(color = "skyblue") +
  geom_text(aes(x = median(df1$df$date, na.rm = T),
                   y = 105,label = "ECA", color = "red")) +
  labs(x = "", y = "PM10")+
  theme_minimal() + theme(legend.position = "none")

plotly::ggplotly(g6)
```

#### PM2.5
```{r}
#| title: "PM2.5 diario"

df1$eca<- df1$eca %>% 
  mutate(fecha = as.Date(fecha, format = "%d-%B"))

g7 <- df1$eca %>% 
  ggplot(aes(x = fecha, y = pm25)) +
  geom_hline(yintercept = 50, lty = 2, color = "hotpink") +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(x = median(fecha),
                   y = 55,label = "ECA"),
            color = "red" ) +
  labs(x = "", y = "PM2.5")+
  theme_minimal()

plotly::ggplotly(g7)
```

```{r}
#| title: "PM2.5 horario"

g8 <- df1$df %>% 
  ggplot(aes(x = date, y = pm25)) +
  geom_hline(yintercept = 50, lty = 2, color = "hotpink") +
  geom_line(color = "skyblue") +
  geom_text(aes(x = median(df1$df$date, na.rm = T),
                   y = 55,label = "ECA",
                color = "red")) +
  labs(x = "", y = "PM2.5")+
  theme_minimal() + theme(legend.position = "none")

plotly::ggplotly(g8)
```

#### Tabla de datos

```{r}
#| title: "Datos diarios (ug/m3)"
library(DT)

n1 <- df1$eca %>% 
  rename_at(
      vars(names(.)),
      ~ c("Fecha", "PM2.5", "PM10", 
          "NO2", "SO2", "H2S",
          "CO(1h)", "CO(8h)", "O3(8h)"))

datatable(
  n1, extensions = 'Buttons',
  caption = 'Tabla 1: Datos horarios - Instituto Vigil',
  options = list(
    autowidth = TRUE,
    pageLength = 20,
    dom = 'Bfrtip',
    buttons = list('copy', 'print', list(
        extend = 'collection',
        buttons = c('csv', 'excel', 'pdf'),
        text = 'Download')))
  ) %>% formatRound(
    columns = colnames(n1 %>% select(-Fecha)), digits = 2)
```

### Mapa web

xdd

### Índice de Calidad de Aire

xdd


# Descarga de datos

| Descripción                             | Links de descarga          |
|-----------------------------------------|----------------------------|
| Datos diarios de Calidad de aire del 2023 | [eca_2024](input/eca_2024.csv)     |
| Datos diarios de Calidad de aire del 2024 | [eca_2024](input/eca_2024.csv)     |
| Reporte de valores diarios mensuales   | [eca_2024](input/eca_2024.csv) |